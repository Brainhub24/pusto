{% macro partial(text, active=None, app) -%}
<div class="b-viewer"><div class="wrap">
    {% for bit in text.bits -%}
    {% set index = bit._id and loop.index or 'new' %}
    <div id="bit-{{ index }}" name="bit-{{ index }}" class="bit">
        <a href="#" class="info">#{{ index }}</a>
        {% if bit.body %}{{ bit.body|rst }}{% else %}<p><b>Нужно бы что-то написать...</b></p>{% endif %}
    </div>
    {%- endfor %}
</div></div>
<div class="b-editor">
    <form method="post" id="editor-form" action="{{ app.url_for(':editor.bit') }}">
        <div class="toolbar choicer">
            <select id="bit-choicer" name="bit">
                {% for bit in text.bits -%}
                {% set index = bit._id and loop.index or 'new' %}
                <option{% if active._id == bit._id %} selected="selected"{% endif %} value="{{ bit._id or 'new' }}">#{{ index }}</option>
                {% endfor %}
            </select>
            <select id="bit-insert" name="insert">
                <option value="">-----</option>
                <option value="before">перед</option>
                <option value="after">после</option>
            </select>
            <select id="bit-parent" name="parent"></select>
        </div>
        <div class="textarea">
            <textarea name="body">{{ active.body }}</textarea>
        </div>
        <div class="toolbar actions">
            <button id="action-apply" type="submit" name="action" value="apply">Готово</button>
            <button id="action-delete" type="submit" name="action" value="delete">Удалить</button>
            <button id="action-reset" type="submit" value="reset">Сброс</button>
        </div>
    </form>
</div>
{%- endmacro %}
