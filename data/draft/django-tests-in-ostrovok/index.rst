Django tests. Практические советы
---------------------------------
- `habr <habr/>`_
- `ru-pycon-2013 </s/2013-ru-pycon/>`_

..
    - введение
    - избегайте static fixtures
    - трюк с settings
    - транзакции наше все
    - cache and redis
    - в несколько процесов (djtest-bootstrap)

По следам внедрения тестов в команде ostrovok.ru [#]_ хотел бы записать несколько
практических советов.

.. [#] статья о первых шагах `на хабре`__, `слайды`__ с Pycon Russia 2013 об оптимизации.

__ ./
__ ./

В ostrovok.ru мне нужно было возобновить написание тестов. Проект уже жил больше года как
до меня и имел довольно обширную кодовую базу.

Я уже писал на `хабре (26.06.2012)`__ про начало внедрения тестирования, потом через пол
года на `Pycon Russia (24.02.2013)`__ рассказывал про оптимизацию и запуск тестов в
несколько процессов. Сейчас я уже не работаю в ostrovok.ru и хотел бы провести
ретроспективу.

__ ./
__ ./

Тесты внедрить удалось, на момент ухода из ostrovok.ru их было порядка тысячи и тесты
продолжали писаться. Все ли было гладко? Нет, не гладко, но все по порядку.

Начинать внедрять тесты в большой проект - это сложно, если у вас нет ресурсов и вам
удастся выкраить совсем немного времени - не начинайте. В ostrovok.ru с этим моментом было
хорошо. Когда меня брали и я говорил про тесты - мне почти всегда давали зеленый свет,
говорили да тесты нужны, сможешь внедрить - давай!

Статические фикстуры - зло. Я старался избегать, но все таки совсем без них было
невозможно. Фикстуры должны быть динамическими. Перегенерация фикстур должна быть встроена
в процесс CI.

Много моков усложняют жизнь, вообще моки не всегда очивидны, но без них по моему мнению
невозможно, когда есть куча разных сервисов, с которыми общается основной проект.
Невозможно построить тестовую среду с гарантированным прохождением тестов на реальных
запросах. Мы в некоторых местах оставляли реальные запросы, был сервис гео базы, который
вроде работал очень стабильно в локальной сети(т.е. отвечал быстро), но даже его в итоге
перевели на фикстуры, правда фикстуры генерились скриптом при обновлении гео базы, т.е.
были динамическими.
